# プロダクトのタイトル
  登山記録
## プロダクトの紹介
- 登山の記録を残すプロダクト。
- SNSっぽいサイトを目指してます。

- 変更点
- いいね機能とユーザーアイコン表示を追加
- 見た目を少し変変更
- 投稿画面をハンバーガーニューからモーダルウィドウへ変更 +を押すとモーダルウィンドウがでる


## 苦戦した点，共有したいハマりポイントなど
-●follow_page.php
-★フォローしているユーザーのみの投稿を表示するのに苦労
-ここでのDBの情報取得は●ユーザーを管理しているテーブル、●ユーザーフォロー関係のテーブル、●投稿データのテーブル、●いいね履歴のテーブルを絡めてデータを抽出。
-その際、どうしても一時的に新たに情報を結びつける用のテーブルが必要になったためCREATE TEMPORARY TABLEで一時テーブルを作成し何とかデータ抽出ができました。

-★いいねの表示の処理と表示の仕方に苦労
-まずログインユーザーがいいねを押している投稿のみハートがCSSで赤くなるようにしている。
-ここではハートを押すたびにページのリロードが行われるのを回避したかったのでAjaxをつかって非同期処理を行うようにしました。

-初めはハートを押すとDBへデータが送られてすでにユーザーがいいねしていればテーブルから削除、していなければ追加とし投稿に対しての全体のいいね数をカウントして合計数を返す（授業と同じ処理）という処理をしてajaxで非同期的に合計数をjsonで渡すという流れでやってました。しかしその方法ではjsonの値が配列ではなくstringという値で変ってくるのでデータを吸い上げることができませんでした、、、
その後いろいろ検証してみたところどうやら値を返す処理で$stmt->execute();を複数行っている（ここではここではDBを書き換える処理とここではいいねのカウント数を取得する処理）と値がstringになるのではないかと判断。
-上記の処理を二つのファイルで分けて実行するようにした。
-その際ajaxの処理も二つに分けて書くことにしました。はじめはボタンを押したときの処理（ここではDBを書き換える処理【like_create.php】）、そしてそのあとデータが返ってきて.thenの処理で再度ajaxで処理（ここではいいねのカウント数を取得する処理【like_create2.php】）
-そうするとちゃんと配列で値が返ってきました。
-後々考えたのですが見た目上の処理でよければ数字の変動は+1か-1なのでカウント数をわざわざajaxで処理しなくてもjsだけでもできるのではと思いました（笑）
-しかしPHPとSQLだけで処理したのは大変勉強になったので自分としてはプラスです！

